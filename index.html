<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø®Ø±ÙŠØ·Ø© Ù‚Ø·ÙˆØ¹Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ - Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS for interactive maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-geoman-free/dist/leaflet-geoman.css" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;800&family=Montserrat:wght@500;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-bg: #171c2b;
      --gradient-bg: linear-gradient(120deg,#20242f 0%, #244868 53%, #5165af 100%);
      --panel-bg: linear-gradient(112deg,#f7fafb 82%,#fdfffb 100%);
      --accent-green: #38ffcf;
      --accent-blue: #61a6ff;
      --accent-yellow: #ffe065;
      --accent-red: #ff6d6d;
      --bshadow: 0 9px 60px 0px #6e7bb570, 0 1.5px 10px 1px #c1d7ebba;
      --radius-lg: 28px;
      --radius-md: 18px;
      --radius-sm: 9px;
      --border: 2.2px solid #e7f0fe;
      --neonshadow: 0 0 12px #58ffe5ad;
    }
    /* Gradient background for body */
    body {
      font-family: 'Cairo', 'Montserrat', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      background: var(--gradient-bg);
      color: #263148;
      letter-spacing: 0.2px;
      position: relative;
      /* Soft pattern */
      background-image: repeating-linear-gradient(155deg, #27304d09 0, #6168aa17 300px);
      overflow-x: hidden;
    }
    body::before {
      content: "";
      position: fixed;
      z-index: 0;
      inset:0;
      pointer-events: none;
      background: 
        radial-gradient(ellipse 35% 12% at 80% 8%, #7adfffba 0%, transparent 80%),
        radial-gradient(circle 19% at 16% 17%, #38eca850 0%, transparent 80%),
        radial-gradient(ellipse 30% 12% at 95% 75%, #ffe87322 0%, transparent 98%);
      opacity: .52;
      transition: opacity .3s;
    }
    header {
      background: linear-gradient(87deg, #202f60 56%, #60e6ed40 145%);
      color: #fff;
      padding: 2.3em 0 1.2em 0;
      text-align: center;
      font-size: 2.2em;
      font-family: 'Montserrat', 'Cairo', Arial, sans-serif;
      letter-spacing: 1.7px;
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
      box-shadow: 0 8px 40px 0px #497ea256;
      text-shadow: 0 3px 15px #4ccbe494, 0 1px 5px #17295850;
      font-weight: 900;
      margin-bottom: 1.2em;
      backdrop-filter: blur(3px);
      position: relative;
      animation: header-slide 0.9s cubic-bezier(.34,1.5,.43,.99);
      z-index: 3;
      overflow: visible;
    }
    @keyframes header-slide {
      from {transform:translateY(-48px) scaleX(0.98);opacity:.32;}
      to {transform:none;opacity:1;}
    }
    #map {
      width: min(99vw, 1140px);
      height: 60vh;
      min-height: 320px;
      max-width: 1100px;
      margin: 30px auto 0 auto;
      border-radius: var(--radius-lg);
      box-shadow: 0 12px 70px 1px #5fe8f46c, var(--bshadow);
      border: 2.5px solid #cde4fb;
      overflow: hidden;
      transition: box-shadow .22s;
      background: #e9f7fa linear-gradient(110deg,#d5fbfd27 60%,#f9f6e5 100%);
      position: relative;
      z-index: 2;
      animation: map-fade 0.65s cubic-bezier(.51,1.35,.40,.98);
    }
    @keyframes map-fade {
      from {opacity:.25;filter:blur(6px);}
      to{opacity:1;filter:none;}
    }
    /* Stylish overlay effects */
    #map::after {
      content:"";
      pointer-events:none;
      position:absolute;
      left:0;top:0;right:0;bottom:0;
      z-index:1;
      background: radial-gradient(ellipse 130% 78% at 50% 90%, #fffbf40a 0%, transparent 75%);
      mix-blend-mode: screen;
      opacity:.7;
    }

    /* Info panel */
    .info-panel {
      max-width: 1110px;
      margin: 2.5em auto 3.2em auto;
      background: var(--panel-bg);
      padding: 2.2em 2.9em 1.95em 2.4em;
      border-radius: var(--radius-md);
      box-shadow: 0 10px 38px #bcd9f92a, 0 5px 25px #9fe4fd11;
      border: var(--border);
      backdrop-filter: blur(8px);
      position: relative;
      z-index: 2;
      animation: panel-in .8s cubic-bezier(.47,1.37,.45,1);
    }
    @keyframes panel-in {
      from {opacity:0;transform: translateY(38px);}
      to {opacity:1;transform:none;}
    }
    h2 {
      font-weight: 900;
      font-size: 1.43em;
      color: #1b2961;
      margin: 0 0 1.07em 0;
      letter-spacing: .7px;
      font-family: 'Montserrat','Cairo',Arial,sans-serif;
      text-shadow: 0 2px 9px #a9edf91a;
      display: flex;
      align-items: center;
      gap: .5em;
      background: linear-gradient(92deg,#f6fecc 60%,#e2fffc00 100%);
      border-radius: var(--radius-sm);
      padding:.19em 1.3em .23em .93em;
      width: fit-content;
      box-shadow:0 2px 14px #ffd13912;
      position:relative;
    }
    h2:before {
      content: "";
      width: 29px; height: 29px;
      display: inline-block;
      border-radius: 50%;
      background: radial-gradient(circle at 65% 35%, var(--accent-green) 45%, var(--accent-blue) 100%);
      box-shadow: 0 2px 16px #65ffe93b, 0 1px 7px #35f8de25;
      margin-left: .19em;
      margin-bottom: -.05em;
      animation: glowh 1.8s infinite alternate cubic-bezier(.78,.06,.68,.98);
    }
    @keyframes glowh {
      from{box-shadow:0 0 13px #81ffd72e;}
      to{box-shadow:0 0 32px #29fec5ba;}
    }
    .neighborhood-list {
      overflow-x: auto;
    }
    .legend-modern {
      border-radius: 13px;
      background: linear-gradient(90deg,#f3fef3 84%,#fffbe1 100%);
      box-shadow: 0 1px 9px #6dff9a3c;
      padding: 0.74em 2em 0.58em 1.3em;
      font-size: 1.05em;
      margin-bottom: 1.13em;
      margin-top: 0.57em;
      display: inline-block;
      position:relative;
      border: 1.7px solid #e9ebed;
      font-weight: 700;
      letter-spacing:.2px;
    }
    .legend-modern .status-dot {margin-right:.3em;margin-left:.89em;vertical-align:middle;}
    .legend-modern .status-dot:last-child {margin-left:0;}
    .no-data-msg {
      color: #9f7800;
      background: linear-gradient(90deg, #fff9d1 80%, #f6fff5 100%);
      border-radius: 6px;
      padding: 0.72em 1.18em;
      margin-top: 1.05em;
      font-size: 1em;
      display: inline-block;
      box-shadow: 0 1px 9px #ffde8031;
      font-weight:500;
      text-shadow:0 2px 10px #ffdfbc31,0 1px 5px #e4ffba14;
    }
    table {
      border-radius: var(--radius-sm);
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      background: #f8fffbe9;
      box-shadow: 0 2.5px 35px #bef5e82b;
      overflow: hidden;
      margin-bottom: 0.7em;
      font-family: 'Cairo','Montserrat',Arial,sans-serif;
      font-size:1.07em;
    }
    th, td {
      padding: 1.12em 0.25em 1.07em 0.25em;
      border-bottom: 1.6px solid #e3ecd4;
      text-align: center;
      font-size: 1.13em;
    }
    th {
      background: linear-gradient(92deg,#e0f2fc 80%,#ecfaf521 100%);
      font-weight: 900;
      color: #3b8eef;
      letter-spacing: 1.1px;
      border-bottom: 3px solid #b3deff;
      text-shadow: 0 1px 6px #b8effe1e;
      font-size: 1.05em;
    }

    /* Row status coloring */
    tr.running {
      background: linear-gradient(90deg,#dcffe7 75%,#87fbecd5 130%);
      border-right: 8px solid #05fcc6b2;
      box-shadow: 0 2px 29px #59ffc124;
      transition: background .17s;
    }
    tr.off {
      background: linear-gradient(93deg,#ffeaea 75%,#ffc7ce 120%);
      border-right: 8px solid #ff6464d7;
      box-shadow: 0 2px 38px #f8bcb764;
      transition: background .18s;
    }
    tr.returningsoon {
      background: linear-gradient(95deg,#fffcd2 78%,#ffe9a3ca 132%);
      border-right: 8px solid #ffe78eca;
      box-shadow: 0 2px 23px #fffda11e;
      transition: background .17s;
    }
    /* Row hover effect */
    tbody tr:nth-child(even):not(.off):not(.running):not(.returningsoon) {
      background: #f6fafbcd;
    }
    tr:hover {
      filter:brightness(1.037) drop-shadow(0 2px 17px #b0f6ed33);
      z-index:2;
      cursor:pointer;
      box-shadow:0 2px 24px #52f3a520;
    }
    .status-dot {
      display: inline-block;
      width: 1.2em; height: 1.13em;
      border-radius: 50%;
      vertical-align: middle;
      box-shadow: 0 1.5px 8px #cde0ef99, 0 0px 5px #fff9;
      border:3px solid #f8faff;
      margin-left: 0.36em;
      margin-right: 0.09em;
      transition: box-shadow .14s;
      position: relative;
    }
    .dot-running {background: linear-gradient(145deg,#73ffce 25%,#2afccd 80%,#13b1a6);}
    .dot-off {background: linear-gradient(121deg,#ff5959 10%,#fc7e7a 65%,#ef445a);}
    .dot-returningsoon {background: linear-gradient(130deg,#ffe96a,#fff08e 91%,#ffc600);}
    /* Animating dot shimmer */
    .status-dot:after {
      content:'';
      display:block;
      position:absolute;
      left:31%;top:22%;
      width:37%;height:38%;
      border-radius:50%;
      background:rgba(255,255,255,.14);
    }

    /* Map polygons hover */
    .leaflet-interactive.district-shape {
      transition: filter .21s, stroke .21s, stroke-width .21s;
      stroke-dasharray:0;
      filter: drop-shadow(0 0 6px #26f8c642);
      opacity:.97;
      cursor:pointer;
    }
    .leaflet-interactive.district-shape.hovered {
      filter: brightness(1.14) drop-shadow(0 0 18px #53feee77);
      stroke-width: 4.8px !important;
      opacity:1;
      z-index:15;
      stroke-dasharray: 4 2;
    }

    /* Modern leaflet popup and tooltip */
    .leaflet-popup-content-wrapper {
      font-family: "Cairo", Arial, sans-serif;
      direction: rtl;
      text-align: right;
      font-size:1.15em;
      border-radius:17px;
      animation: popupAppear 0.33s cubic-bezier(.41,1.35,.42,1);
      box-shadow:0 4px 35px #afeffb22, 0 1.5px 16px #6af5e881;
      border:2px solid #d6fff2;
      background: #f7fefd;
    }
    .leaflet-popup-tip { background:#daf6fd!important;}
    @keyframes popupAppear {
      from {transform:scale(0.93) translateY(17px);opacity:0;}
      to {transform:scale(1) translateY(0);opacity:1;}
    }

    /* Scrollbars */
    ::-webkit-scrollbar {
      width: 8px;
      background: #d2f3f7;
      border-radius: 10px;
      height: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background: #cde3f248;
      border-radius: 10px;
      min-height:42px;
    }

    /* Responsive: Panel & Map */
    @media (max-width:1150px){
      #map,.info-panel { max-width:96vw;}
    }
    @media(max-width:900px){
      #map { height: 320px; max-width:99vw; }
      .info-panel {max-width:98vw; padding:1.1em 0.47em;}
      th, td {font-size:0.95em;}
      header {font-size:1.19em;}
    }
    @media (max-width:650px){
      .info-panel {padding:0.68em 0.15em;}
      h2 {font-size:1em;}
      header {font-size:0.98em;padding:0.7em 0;}
      #map {border-radius:12px;}
      .info-panel {border-radius:10px;}
      th,td {padding:0.55em 0.10em;}
      .legend-modern {padding:0.45em 0.95em;}
    }

    /* Action neon border for selected */
    .polygon-active {
      box-shadow:0 0 0 5px #4bfedabf !important;
      filter:brightness(1.20) drop-shadow(0 0 22px #29fee296);
      stroke-width:5.9px !important;
      animation: neonborder 1.6s infinite alternate cubic-bezier(.2,.97,.14,1);
    }
    @keyframes neonborder {
      from{outline:2px solid #83ffd829;}
      to{outline:2px solid #53f7fa;}
    }
  </style>
</head>
<body>
  <header>
    Ø®Ø±ÙŠØ·Ø© Ù‚Ø·ÙˆØ¹Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡<br>
    <span style="font-size:0.67em;font-weight:500;letter-spacing:.9px;color:#d0feff;">ÙÙŠ Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</span>
  </header>
  <div id="map" role="region" aria-label="Ø®Ø±ÙŠØ·Ø© Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø®Ø±Ø·ÙˆÙ…"></div>
  <div class="info-panel fade-in">
    <h2>Ø¬Ø¯ÙˆÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø¨Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</h2>
    <div class="neighborhood-list">
      <div class="legend-modern" aria-hidden="false">
        <span class="status-dot dot-running"></span>Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ØªØ¹Ù…Ù„
        <span class="status-dot dot-off"></span>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡
        <span class="status-dot dot-returningsoon"></span>ØªØ¹ÙˆØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹
      </div>
      <table id="power-table">
        <thead>
          <tr>
            <th>Ø§Ù„Ø­ÙŠ</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¢Ù†</th>
            <th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù‚Ø§Ø¯Ù…</th>
            <th>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</th>
            <th>ÙˆÙ‚Øª Ø±Ø¬ÙˆØ¹ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</th>
            <th>Ù…Ù†Ø°</th>
          </tr>
        </thead>
        <tbody id="district-table"></tbody>
      </table>
      <div class="no-data-msg">
        Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© - Ø³ÙŠØ¶Ø§Ù Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹.
      </div>
    </div>
  </div>
  <!-- Leaflet JS and plugins -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-geoman-free/dist/leaflet-geoman.min.js"></script>
  <script type="importmap">
  {
    "imports": {}
  }
  </script>
  <script>
    //------------ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹) -----------------
    const neighborhoodsGeo = [
      {
        name: "Ø§Ù„Ø¹Ù…Ø§Ø±Ø§Øª",
        status: "on",
        next_cut: "16:00",
        cut_duration: 3,
        return_time: "19:00",
        since: "Ø³Ø§Ø¹ØªÙŠÙ†",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.5961, 32.5322], [15.5961, 32.5415],
            [15.5885, 32.5419], [15.5887, 32.5326],
            [15.5961, 32.5322]
          ]]
        },
        lat: 15.5925, lng: 32.5370
      },
      {
        name: "Ø¨Ø­Ø±ÙŠ (Ø§Ù„Ø´Ù…Ø¨Ø§Øª)",
        status: "off",
        next_cut: "15:30",
        cut_duration: 2,
        return_time: "17:30",
        since: "30 Ø¯Ù‚ÙŠÙ‚Ø©",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.6650, 32.5440], [15.6652, 32.5559],
            [15.6587, 32.5576], [15.6587, 32.5454],
            [15.6650, 32.5440]
          ]]
        },
        lat:15.6620, lng:32.5505
      },
      {
        name: "Ø£Ø±ÙƒÙˆÙŠØª",
        status: "on",
        next_cut: "19:00",
        cut_duration: 4,
        return_time: "23:00",
        since: "Ø³Ø§Ø¹ØªÙŠÙ†",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.5644,32.5763],[15.5646,32.5811],
            [15.5579,32.5814],[15.5578,32.5745],
            [15.5644,32.5763]
          ]]
        },
        lat:15.5610, lng:32.5778
      },
      {
        name: "Ø£Ù… Ø¯Ø±Ù…Ø§Ù† ÙˆØ³Ø·",
        status: "off",
        next_cut: "16:00",
        cut_duration: 3,
        return_time: "19:00",
        since: "40 Ø¯Ù‚ÙŠÙ‚Ø©",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.6459,32.4749],[15.6460,32.4827],
            [15.6402,32.4836],[15.6401,32.4758],
            [15.6459,32.4749]
          ]]
        },
        lat:15.6430, lng:32.4795
      },
      {
        name: "Ø§Ù…ØªØ¯Ø§Ø¯ Ù†Ø§ØµØ±",
        status: "on",
        next_cut: "17:30",
        cut_duration: 2,
        return_time: "19:30",
        since: "Ø³Ø§Ø¹ØªÙŠÙ†",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.5580,32.5433],[15.5582,32.5502],
            [15.5526,32.5504],[15.5528,32.5437],
            [15.5580,32.5433]
          ]]
        },
        lat:15.5553, lng:32.5470
      },
      {
        name: "Ø§Ù„Ø¬Ø±ÙŠÙ ØºØ±Ø¨",
        status: "returningsoon",
        next_cut: "18:00",
        cut_duration: 3,
        return_time: "21:00",
        since: "5 Ø¯Ù‚Ø§Ø¦Ù‚",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.5676,32.5697],[15.5680,32.5742],
            [15.5633,32.5745],[15.5630,32.5699],
            [15.5676,32.5697]
          ]]
        },
        lat:15.5650, lng:32.5720
      },
      // New neighborhoods below:
      {
        name: "Ø­Ù…Ø¯ Ø§Ù„Ù†ÙŠÙ„",
        status: "returningsoon",
        next_cut: "17:45",
        cut_duration: 3,
        return_time: "20:45",
        since: "20 Ø¯Ù‚ÙŠÙ‚Ø©",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.6422, 32.5625], [15.6425, 32.5708],
            [15.6333, 32.5709], [15.6330, 32.5630],
            [15.6422, 32.5625]
          ]]
        },
        lat: 15.6377, lng: 32.5666
      },
      {
        name: "Ø¬Ø±Ø§Ù ØºØ±Ø¨",
        status: "on",
        next_cut: "20:30",
        cut_duration: 4,
        return_time: "00:30",
        since: "3 Ø³Ø§Ø¹Ø§Øª",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.6209, 32.5703], [15.6210, 32.5789],
            [15.6142, 32.5793], [15.6141, 32.5708],
            [15.6209, 32.5703]
          ]]
        },
        lat: 15.6175, lng: 32.5745
      },
      {
        name: "Ø§Ù„Ø¬ÙŠÙ„ÙŠ",
        status: "off",
        next_cut: "22:00",
        cut_duration: 6,
        return_time: "04:00",
        since: "Ø³Ø§Ø¹Ø© ÙˆØ±Ø¨Ø¹",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.6833, 32.5266], [15.6835, 32.5382],
            [15.6768, 32.5386], [15.6767, 32.5271],
            [15.6833, 32.5266]
          ]]
        },
        lat: 15.6799, lng: 32.5324
      },
      {
        name: "Ø§Ù„Ù…Ù†Ø´ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©",
        status: "returningsoon",
        next_cut: "16:20",
        cut_duration: 1,
        return_time: "17:20",
        since: "5 Ø¯Ù‚Ø§Ø¦Ù‚",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.5532, 32.5539], [15.5534, 32.5601],
            [15.5478, 32.5603], [15.5477, 32.5542],
            [15.5532, 32.5539]
          ]]
        },
        lat: 15.5504, lng: 32.5571
      },
      {
        name: "Ø§Ù„Ù‡Ù…Ø´ÙŠØ±Ø§Ø¨",
        status: "on",
        next_cut: "18:45",
        cut_duration: 2,
        return_time: "20:45",
        since: "Ø³Ø§Ø¹ØªÙŠÙ†",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.5987, 32.4863], [15.5989, 32.4932],
            [15.5917, 32.4941], [15.5915, 32.4867],
            [15.5987, 32.4863]
          ]]
        },
        lat: 15.5963, lng: 32.4902
      },
      {
        name: "Ø¨Ø­Ø±ÙŠ Ø´Ù…Ø§Ù„",
        status: "off",
        next_cut: "16:10",
        cut_duration: 3,
        return_time: "19:10",
        since: "45 Ø¯Ù‚ÙŠÙ‚Ø©",
        geometry: {
          "type": "Polygon",
          "coordinates": [[
            [15.6720, 32.5290], [15.6721, 32.5410],
            [15.6640, 32.5414], [15.6639, 32.5287],
            [15.6720, 32.5290]
          ]]
        },
        lat: 15.6680, lng: 32.5350
      }
    ];

    // Ø£Ù„ÙˆØ§Ù† ÙˆÙ…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©:
    const statusInfo = {
      "on":   {
        label: "Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ØªØ¹Ù…Ù„",
        color: "#14f6c0",
        dotClass:"dot-running",
        rowClass:'running',
        fillOpacity: 0.85,
        border: "#12e8d7"
      },
      "off":  {
        label: "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡",
        color: "#fe6069",
        dotClass:"dot-off",
        rowClass:'off',
        fillOpacity: 0.77,
        border: "#ff7676"
      },
      "returningsoon": {
        label:"Ø³ØªØ¹ÙˆØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹",
        color:"#ffe87a",
        dotClass:'dot-returningsoon',
        rowClass:'returningsoon',
        fillOpacity:0.88,
        border:"#ffd64e"
      }
    };

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹ØµØ±ÙŠÙ‘Ø©
    const map = L.map('map', {
      zoomControl: false,
      minZoom: 11,
      maxZoom: 14
    }).setView([15.61, 32.55], 12);

    // Ø·Ø¨Ù‚Ø© Ù…Ø¬Ø§Ù†ÙŠØ©: OpenStreetMap Ø§Ù„Ø¹ØµØ±ÙŠÙ‘Ø©
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
      opacity:.98
    }).addTo(map);

    // Ø±Ø³Ù… Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØªÙ„ÙˆÙŠÙ†Ù‡Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ø­ÙŠ
    let polygonsList = [];
    neighborhoodsGeo.forEach(nh => {
      const info = statusInfo[nh.status];
      const style = {
        color: info.border,
        fillColor: info.color,
        fillOpacity: info.fillOpacity,
        opacity: 1,
        weight: 3.6,
        dashArray: nh.status ==="returningsoon" ? "6 4" : "",
        className: "district-shape"
      };

      const polygon = L.polygon(nh.geometry.coordinates, style).addTo(map);

      // Ø¹Ø±Ø¶ popup Ù…Ø®ØµØµ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
      polygon.bindPopup(`
        <div style="font-size:1.17em;display:flex;gap:0.6em;align-items:center;margin-bottom:2px">
          <span class="status-dot ${info.dotClass}"></span>
          <span style="font-weight:900;letter-spacing:0.3px">${nh.name}</span>
        </div>
        <div style="margin:.4em 0 0.15em 0;line-height:1.7">
          <span style="font-weight:600">Ø§Ù„Ø­Ø§Ù„Ø©:</span> <b>${info.label}</b><br>
          ğŸ•‘ <b>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù‚Ø§Ø¯Ù…:</b> ${nh.next_cut} 
          <span style="color:#aaa">/ ${nh.cut_duration} Ø³</span><br>
          âš¡ <b>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹:</b> ${nh.return_time}<br>
          â³ <b>Ù…Ù†Ø°:</b> ${nh.since}
        </div>
      `);

      // Ø¹Ø±Ø¶ ØªÙ„Ù…ÙŠØ­ ØµØºÙŠØ± Ø¹Ù†Ø¯ hover
      polygon.on('mouseover', function(e) {
        polygon._leaflet_id_ogClass = polygon._path.className;
        polygon._path.classList.add("hovered");
        const tooltip = L.tooltip({
          permanent:false,
          direction:'top',
          offset:[0,-14],
          className:'city-tooltip'
        })
        .setLatLng(e.latlng)
        .setContent(`<span>${nh.name}</span>`)
        .addTo(map);
        polygon._tmpTooltip = tooltip;
      }).on('mouseout', function() {
        if (polygon._tmpTooltip) map.removeLayer(polygon._tmpTooltip);
        polygon._path.classList.remove("hovered");
      });

      // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø¨ØµØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
      polygon.on('click', function() {
        polygonsList.forEach(p => p._path.classList.remove("polygon-active"));
        polygon._path.classList.add("polygon-active");
        setTimeout(()=>polygon._path.classList.remove("polygon-active"),1600);
      });

      polygonsList.push(polygon);
    });

    // Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø¹ØµØ±ÙŠ
    const tbody = document.getElementById('district-table');
    tbody.innerHTML = '';
    neighborhoodsGeo.forEach((nh, i) => {
      const info = statusInfo[nh.status];
      const tr = document.createElement('tr');
      tr.className = info.rowClass;
      tr.innerHTML = `
        <td><strong>${nh.name}</strong></td>
        <td><span class="status-dot ${info.dotClass}"></span>${info.label}</td>
        <td>${nh.next_cut}</td>
        <td>${nh.cut_duration} Ø³Ø§Ø¹Ø©</td>
        <td>${nh.return_time}</td>
        <td>${nh.since}</td>
      `;
      // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ ØµÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„: Ø²ÙˆÙ‘Ù… Ù„Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù„Ù‰ polygon Ø§Ù„Ø­ÙŠ ÙˆØ§ÙØªØ­ popup
      tr.addEventListener('click', () => {
        const poly = polygonsList[i];
        map.flyTo(poly.getBounds().getCenter(), 14, {animate:true, duration:0.7});
        setTimeout(()=>{ poly.openPopup(); }, 430);
        polygonsList.forEach(p => p._path.classList.remove("polygon-active"));
        poly._path.classList.add("polygon-active");
        setTimeout(()=>poly._path.classList.remove("polygon-active"),1400);
      });
      tbody.appendChild(tr);
    });

    // ØªØ¹Ø·ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª ØªØ­Ø±ÙŠØ± Ø¬ÙŠÙˆÙ…Ø§Ù† Ù„Ù„Ø²Ø§Ø¦Ø± ÙˆØ¹Ø±Ø¶ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø²ÙˆÙ… ÙÙ‚Ø·
    map.pm && map.pm.disableDraw('Polygon');
    map.pm && map.pm.disableDraw('Marker');
    if (map.pm && map.pm.Toolbar) map.pm.Toolbar.remove();
    L.control.zoom({position: 'topright'}).addTo(map);
  </script>
</body>
</html>